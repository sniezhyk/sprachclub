<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Felix test page</title>
  </head>

  <body>
    <div>
      <input id="upload" type="file" multiple />
      <label>EventId: <input id="eventId" type="number" /></label>
      <button id="upload-btn">Upload</button>
    </div>
    <div>
      <label>EventId: <input id="infoId" type="number" /></label>
      <button id="info-btn">List attachments for event</button>
    </div>
    <div id="attachment-list"></div>
    <div>
      <label>AttachmentId: <input id="deleteId" type="number" /></label>
      <button id="delete-btn">Delete</button>
    </div>
    <div>
      <label>AttachmentId: <input id="attachmentId" type="number" /></label>
      <button id="download-btn">Download</button>
    </div>
    <div id="downloaded-images"><p>Downloads</p></div>
    <script src="/static/uploaddownload.js"></script>
    <script>
      document
        .getElementById("upload-btn")
        .addEventListener("click", async () => {
          const input = document.getElementById("upload");
          await uploadFiles(input.files);
        });

      document
        .getElementById("info-btn")
        .addEventListener("click", async () => {
          const eventId = document.getElementById("infoId").value;
          const { attachments } = await listAttachments(eventId);
          const container = document.getElementById("attachment-list");
          for (const { id, fileName } of attachments) {
            const div = document.createElement("div");
            div.innerHTML = `Attachment ${id}: ${fileName}`;
            container.appendChild(div);
          }
        });

      document
        .getElementById("download-btn")
        .addEventListener("click", async () => {
          const { fileName, fileType, fileSize, fileBuf } = await downloadFile(
            document.getElementById("attachmentId").value
          );

          const container = document.getElementById("downloaded-images");
          if (fileType.startsWith("image/")) {
            const img = document.createElement("img");
            container.appendChild(img);
            img.src = URL.createObjectURL(
              new Blob([fileBuf.buffer], { type: fileType })
            );
          } else {
            const button = document.createElement("button");
            container.appendChild(button);
            button.innerHTML = "Download " + fileName;
            button.onclick = () => {
              downloadBlob(fileBuf, fileName, fileType);
            };
          }
        });

      document
        .getElementById("delete-btn")
        .addEventListener("click", async () => {
          const attachmentId = document.getElementById("deleteId").value;
          await deleteAttachment(attachmentId);
        });
    </script>
  </body>
</html>
